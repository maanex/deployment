version: "3.3"

services:
  lumberer:
    image: maanex/lumberer:latest
    volumes:
      - logfiles:/storage
    environment:
      STORAGE_PATH: "/storage"
    networks:
      - logging
    # deploy:
    #   labels:

  thumbnailer:
    image: maanex/thumbnailer:latest
    environment:
      FREESTUFF_KEY: "verysecret"
      METRICS_AUTH: "yikes"
    networks:
      - traefik-public
    deploy:
      labels:
        - traefik.enable=true
        - traefik.docker.network=traefik-public
        - traefik.http.services.thumbnailer.loadbalancer.server.port=9915
        - traefik.http.routers.thumbnailer.entrypoints=https
        - traefik.http.routers.thumbnailer.rule=Host(`thumbnails.freestuffbot.xyz`)
        - traefik.http.routers.thumbnailer.tls.certresolver=letsencrypt

networks:
  traefik-public:
    external: true
  logging:
    external: true

volumes:
  logfiles: {}

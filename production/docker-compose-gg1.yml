version: "3.3"

services:
  fsdiscord:
    image: ghcr.io/freestuffbot/discord:master
    environment:
      NODE_ENV: "production"
      NODE_ID: "gg1"
      FSB_REDIS_HOST: "redis"
      FSB_WORKER_HOST: "ws://manager:9002"
    networks:
      - redis
      - fsm-sockets
    # - logging
    secrets:
      - FSB_DBOT_TOKEN
      - FSB_DBOT_ID
      - FSB_MONGO_URL
      - FSB_FSAPI_KEY
      - FSB_SENTRY_DSN
    deploy:
      mode: replicated
      replicas: 1
      placement:
        constraints:
          - node.hostname == gg1

networks:
  redis:
    external: true
  fsm-sockets:
    external: true
  # logging:
  #   external: true

secrets:
  FSB_DBOT_TOKEN:
    external: true
  FSB_DBOT_ID:
    external: true
  FSB_MONGO_URL:
    external: true
  FSB_FSAPI_KEY:
    external: true
  FSB_SENTRY_DSN:
    external: true
